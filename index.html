<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nick Young — Portfolio (Placeholder)</title>
  <meta name="description" content="Placeholder portfolio for Nick Young. Simple, fast, and Cloudflare Pages-ready." />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #0b0c10;
      --panel: #12141a;
      --soft: #1a1d26;
      --fg: #e6e8ee;
      --muted: #a1a6b3;
      --accent: #7c5cff;
      --accent-2: #00e5ff;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    @media (prefers-color-scheme: light) {
      :root { --bg:#f7f7fb; --panel:#ffffff; --soft:#f1f3f9; --fg:#0c0e12; --muted:#5c6472; --shadow:0 10px 25px rgba(7,12,24,.10); }
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, system-ui, sans-serif;
      background: radial-gradient(1200px 600px at 80% -10%, rgba(124,92,255,.15), transparent 60%),
                  radial-gradient(800px 500px at -10% 20%, rgba(0,229,255,.10), transparent 60%),
                  var(--bg);
      color: var(--fg);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .wrap { width: min(1100px, 92vw); margin: 0 auto; }

    /* ------- Header / Intro ------- */
    header {
      position: sticky; top: 0; left: 0; right: 0; z-index: 20; width: 100%;
      backdrop-filter: saturate(120%) blur(6px);
      background: color-mix(in oklab, var(--bg), transparent 25%);
      border-bottom: 1px solid color-mix(in oklab, var(--muted), transparent 70%);
    }
    .nav { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; }
    .brand { font-weight: 700; letter-spacing: 0.2px; }
    .nav a { color: var(--muted); text-decoration: none; margin-left: 16px; font-size: 14px; }
    .nav a:hover { color: var(--fg); }

    .intro { padding: clamp(52px, 5.5vw, 92px) 0 clamp(18px, 4vw, 28px); display: grid; gap: clamp(30px, 4.5vw, 44px); }
    .intro h1 { font-size: clamp(36px, 6.5vw, 64px); line-height: 1.05; margin: 0 0 14px; letter-spacing: -0.02em; }
    .intro h1 .accent { background: linear-gradient(90deg, var(--accent), var(--accent-2)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .intro p { margin: 0; color: var(--muted); font-size: clamp(16px, 2vw, 18px); max-width: 560px; }
    .intro-card { background: linear-gradient(160deg, color-mix(in oklab, var(--soft), transparent 0%), color-mix(in oklab, var(--panel), transparent 0%)); border-radius: calc(var(--radius) + 2px); border: 1px solid color-mix(in oklab, var(--muted), transparent 55%); box-shadow: var(--shadow); padding: clamp(16px, 2.6vw, 22px); display: grid; grid-template-columns: minmax(0, 1fr) minmax(0, 1.35fr); gap: clamp(16px, 2.8vw, 24px); }
    .intro-pane { background: color-mix(in oklab, var(--soft), transparent 0%); border: 1px solid color-mix(in oklab, var(--muted), transparent 70%); border-radius: calc(var(--radius) - 4px); padding: 14px 16px; display: flex; flex-direction: column; gap: 10px; }
    .intro-pane h2 { margin: 0; font-size: 18px; letter-spacing: -0.01em; }
    .intro-pane .subtitle { color: var(--muted); margin: 0; font-size: 14px; }
    .intro-pane .divider { height: 1px; background: color-mix(in oklab, var(--muted), transparent 72%); margin: 10px 0; border-radius: 999px; }
    .intro-pane .headline { font-weight: 600; margin-bottom: 6px; }
    .intro-pane .label { color: var(--muted); font-size: 12px; }
    .intro-pane .stamp { color: var(--muted); font-size: 12px; display: block; margin-top: 6px; }
    .intro-pane .caption { color: var(--muted); font-size: 12px; margin: 6px 0 0; }
    .ai-chat { border: 1px solid color-mix(in oklab, var(--muted), transparent 60%); border-radius: calc(var(--radius) - 4px); background: color-mix(in oklab, var(--panel), transparent 0%); overflow: hidden; display: flex; flex-direction: column; }
    .ai-chat header { display: flex; align-items: center; gap: 8px; padding: 10px 14px; border-bottom: 1px solid color-mix(in oklab, var(--muted), transparent 75%); color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; }
    .ai-chat .dot { width: 8px; height: 8px; border-radius: 999px; background: #f87171; box-shadow: 14px 0 0 #fbbf24, 28px 0 0 #34d399; }
    .ai-chat .tag { border: 1px solid color-mix(in oklab, var(--muted), transparent 70%); border-radius: 999px; padding: 2px 6px; font-size: 11px; color: var(--muted); }
    .ai-chat .messages { padding: 16px; display: flex; flex-direction: column; gap: 10px; min-height: 160px; }
    .ai-chat .msg { max-width: 90%; padding: 10px 12px; border-radius: 12px; border: 1px solid color-mix(in oklab, var(--muted), transparent 70%); background: color-mix(in oklab, var(--soft), transparent 0%); font-size: 14px; line-height: 1.5; position: relative; }
    .ai-chat .msg.you { align-self: flex-end; background: color-mix(in oklab, var(--panel), transparent 0%); }
    .ai-chat .msg.ai { align-self: flex-start; }
    .ai-chat .meta { color: var(--muted); font-size: 12px; margin-top: 2px; }
    .ai-chat .controls { display: flex; align-items: center; gap: 10px; padding: 12px 16px 16px; border-top: 1px solid color-mix(in oklab, var(--muted), transparent 75%); }
    .ai-chat button { border: 1px solid color-mix(in oklab, var(--muted), transparent 60%); background: color-mix(in oklab, var(--panel), transparent 0%); color: var(--fg); border-radius: 10px; padding: 6px 12px; font-size: 14px; cursor: pointer; }
    .ai-chat button:hover { border-color: color-mix(in oklab, var(--muted), transparent 45%); }
    .ai-chat button:focus-visible { outline: 2px solid var(--accent-2); outline-offset: 2px; }
    .ai-chat .label { color: var(--muted); font-size: 12px; }
    .ai-typing { display: inline-flex; align-items: center; gap: 6px; }
    .ai-typing .dot { width: 6px; height: 6px; border-radius: 999px; background: var(--muted); opacity: .5; box-shadow: none; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
    @keyframes ai-dot-blink { 0% { opacity: .2; } 50% { opacity: 1; } 100% { opacity: .2; } }
    .ai-typing .dot:nth-child(1) { animation: ai-dot-blink 1s linear infinite; }
    .ai-typing .dot:nth-child(2) { animation: ai-dot-blink 1s linear infinite .2s; }
    .ai-typing .dot:nth-child(3) { animation: ai-dot-blink 1s linear infinite .4s; }
    .typing-cursor {
      display: inline-block;
      width: 2px;
      height: 1em;
      background: currentColor;
      margin: 0 2px;
      border-radius: 1px;
      animation: cursor-blink 1s steps(1, end) infinite;
      vertical-align: middle;
    }
    @keyframes cursor-blink {
      0%, 45% { opacity: 1; }
      55%, 100% { opacity: 0; }
    }
    @media (max-width: 900px) {
      .intro-card { grid-template-columns: 1fr; }
    }

    /* ------- Shared Section Styles ------- */
    section { padding: clamp(48px, 6vw, 72px) 0; }
    #featured { padding-top: clamp(36px, 5vw, 56px); scroll-margin-top: 120px; }
    .section-head { display:flex; align-items:flex-start; justify-content:space-between; gap: 16px; margin-bottom: 24px; }
    .section-head h2 { font-size: clamp(24px, 3.2vw, 34px); margin: 0; }
    .section-head p { margin: 0; color: var(--muted); font-size: 14px; max-width: 420px; }

    .tag-list { display:flex; flex-wrap:wrap; gap:8px; }
    .tag { font-size: 12px; padding: 6px 10px; border:1px solid color-mix(in oklab, var(--muted), transparent 60%); border-radius: 999px; color: var(--muted); }

    /* ------- Featured Project ------- */
    .featured-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
      padding: 24px;
      border-radius: calc(var(--radius) + 4px);
      background: linear-gradient(160deg, color-mix(in oklab, var(--panel), transparent 0%), color-mix(in oklab, var(--panel), transparent 0%));
      border: 1px solid color-mix(in oklab, var(--muted), transparent 65%);
      box-shadow: var(--shadow);
      text-decoration: none;
      color: inherit;
      transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease;
    }
    .featured-card:hover { transform: translateY(-2px); border-color: color-mix(in oklab, var(--muted), transparent 45%); box-shadow: 0 18px 45px rgba(0,0,0,.28); }
    .featured-media {
      position: relative;
      border-radius: calc(var(--radius) - 4px);
      overflow: hidden;
      aspect-ratio: 16/9;
      background: linear-gradient(120deg, rgba(255,255,255,.08), rgba(255,255,255,.16) 30%, rgba(255,255,255,.05) 60%),
                  linear-gradient(180deg, var(--soft), color-mix(in oklab, var(--panel), transparent 12%));
      border: 1px solid color-mix(in oklab, var(--muted), transparent 70%);
    }
    .featured-media img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .featured-body { display: flex; flex-direction: column; gap: 16px; }
    .featured-body h3 { margin: 0; font-size: clamp(24px, 3vw, 32px); letter-spacing: -0.01em; }
    .featured-body p { margin: 0; color: var(--muted); font-size: 15px; line-height: 1.6; }
    .featured-meta { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--muted); }

    @media (min-width: 900px) {
      #featured { margin-top: clamp(-60px, -7vw, -36px); }
    }

    /* ------- Timeline ------- */
    .timeline {
      --timeline-preview-small: clamp(160px, 24vh, 220px);
      --timeline-track-x: clamp(110px, 32%, 220px);
      position: relative;
      display: flex;
      flex-direction: column;
      gap: clamp(28px, 4vw, 38px);
      padding-left: clamp(18px, 3vw, 24px);
    }
    .timeline::before {
      content: "";
      position: absolute;
      left: var(--timeline-track-x);
      top: 0;
      bottom: 0;
      width: 2px;
      background: color-mix(in oklab, var(--muted), transparent 55%);
      pointer-events: none;
    }
    .timeline-entry {
      position: relative;
      display: grid;
      grid-template-columns: minmax(120px, 0.34fr) minmax(0, 0.66fr);
      gap: clamp(16px, 3vw, 30px);
      align-items: stretch;
      isolation: isolate;
    }
    .timeline-entry::before {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: var(--timeline-track-x);
      width: 2px;
      background: color-mix(in oklab, var(--muted), transparent 55%);
      opacity: 0;
      transition: opacity .3s ease;
    }
    .timeline-entry.is-expanded::before { opacity: 1; }
    .timeline-date-bucket {
      position: relative;
      padding-right: clamp(12px, 2vw, 20px);
      display: flex;
      justify-content: flex-end;
    }
    .timeline-marker {
      position: relative;
      padding-right: clamp(12px, 2vw, 18px);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }
    .timeline-marker::before {
      content: "";
      position: absolute;
      top: 6px;
      right: -9px;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: color-mix(in oklab, var(--accent), transparent 20%);
      border: 2px solid color-mix(in oklab, var(--accent), transparent 0%);
      box-shadow: 0 0 0 5px color-mix(in oklab, var(--accent), transparent 78%);
      transition: transform .28s ease, box-shadow .28s ease, background .28s ease;
    }
    .timeline-entry.is-expanded .timeline-marker::before {
      transform: scale(1.12);
      box-shadow: 0 0 0 8px color-mix(in oklab, var(--accent-2), transparent 74%);
      background: color-mix(in oklab, var(--accent-2), transparent 0%);
    }
    .timeline-date {
      font-size: 13px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--muted);
      text-align: right;
    }
    .timeline-window {
      position: relative;
      min-height: var(--timeline-preview-small);
      transition: min-height .32s ease;
    }
    .timeline-entry.is-expanded .timeline-window {
      min-height: calc(var(--timeline-preview-small) * 2);
    }
    .timeline-card {
      position: absolute;
      inset: 0;
      display: block;
      text-decoration: none;
      color: inherit;
      overflow: hidden;
      border-radius: var(--radius);
      border: 1px solid color-mix(in oklab, var(--muted), transparent 72%);
      background: linear-gradient(180deg, color-mix(in oklab, var(--panel), transparent 0%), color-mix(in oklab, var(--panel), transparent 0%));
      box-shadow: var(--shadow);
      transition: border-color .28s ease, box-shadow .28s ease;
    }
    .timeline-entry.is-expanded .timeline-card {
      border-color: color-mix(in oklab, var(--accent), transparent 42%);
      box-shadow: 0 20px 48px rgba(0,0,0,.38);
    }
    .timeline-preview {
      position: absolute;
      inset: 0;
      padding: clamp(18px, 2.2vw, 24px);
      display: flex;
      flex-direction: column;
      gap: clamp(14px, 2vw, 18px);
      opacity: 0;
      transform: translateY(14px) scale(.97);
      transition: opacity .32s ease, transform .32s ease;
      pointer-events: none;
    }
    .timeline-preview-small {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .timeline-entry.is-expanded .timeline-preview-small {
      opacity: 0;
      transform: translateY(-10px) scale(.97);
      pointer-events: none;
    }
    .timeline-entry.is-expanded .timeline-preview-large {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .timeline-preview-media {
      position: relative;
      border-radius: calc(var(--radius) - 6px);
      overflow: hidden;
      aspect-ratio: 16/9;
      border: 1px solid color-mix(in oklab, var(--muted), transparent 70%);
      background: linear-gradient(120deg, rgba(255,255,255,.08), rgba(255,255,255,.16) 30%, rgba(255,255,255,.05) 60%),
                  linear-gradient(180deg, var(--soft), color-mix(in oklab, var(--panel), transparent 12%));
    }
    .timeline-preview-media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .timeline-preview-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
    }
    .timeline-preview h3 {
      margin: 0;
      font-size: clamp(20px, 2.5vw, 26px);
      letter-spacing: -0.01em;
    }
    .timeline-preview p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
    }
    .timeline-preview-small p {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .timeline-preview-large .timeline-preview-meta {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      font-size: 13px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .timeline-preview-large .timeline-preview-meta span:last-child {
      font-size: 11px;
      letter-spacing: 0.12em;
    }
    .timeline-preview-large .timeline-cta {
      margin-top: auto;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--accent-2);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }
    .timeline-preview-large .timeline-cta::after {
      content: "→";
      font-size: 12px;
      transform: translateY(-1px);
    }
    .contact-card {
      max-width: 420px;
      background: linear-gradient(180deg, color-mix(in oklab, var(--panel), transparent 0%), color-mix(in oklab, var(--panel), transparent 0%));
      border-radius: var(--radius);
      border: 1px solid color-mix(in oklab, var(--muted), transparent 70%);
      box-shadow: var(--shadow);
      padding: 20px 24px;
    }
    .contact-card a {
      color: inherit;
      text-decoration: none;
      font-weight: 600;
    }
    .contact-card a:hover { color: var(--accent-2); }

    .projects-status { margin: 12px 0 0; color: var(--muted); font-size: 13px; }

    /* ------- Footer ------- */
    footer { padding: 44px 0 64px; color: var(--muted); font-size: 14px; }
    footer .footer-row { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:16px; }
    .back-to-top {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid color-mix(in oklab, var(--muted), transparent 55%);
      color: var(--fg);
      text-decoration: none;
      font-size: 13px;
      background: color-mix(in oklab, var(--panel), transparent 0%);
      transition: border-color .2s ease, transform .2s ease;
    }
    .back-to-top:hover {
      border-color: color-mix(in oklab, var(--muted), transparent 35%);
      transform: translateY(-1px);
    }

    /* ------- Animations & Media Queries ------- */
    .reveal { opacity: 0; transform: translateY(8px); }
    .reveal.show { opacity: 1; transform: none; transition: opacity .5s ease, transform .5s ease; }

    @media (max-width: 720px) {
      .timeline {
        padding-left: 0;
        margin-left: 4px;
      }
      .timeline::before { display: none; }
      .timeline-entry {
        grid-template-columns: 1fr;
        gap: 18px;
      }
      .timeline-entry::before { display: none; }
      .timeline-date-bucket {
        justify-content: flex-start;
      }
      .timeline-marker {
        flex-direction: row;
        align-items: center;
        gap: 12px;
        padding-right: 0;
      }
      .timeline-marker::before {
        position: static;
        order: -1;
        margin-right: 6px;
      }
      .timeline-date { text-align: left; }
      .timeline-window {
        min-height: clamp(180px, 40vh, 260px);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap nav" aria-label="Primary">
      <div class="brand">NickYoungCI.dev</div>
      <nav>
        <a href="#featured">Featured</a>
        <a href="#projects">Timeline</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="intro" id="intro">
      <div class="intro-card" id="ai-intro" aria-labelledby="ai-intro-title">
        <div class="intro-pane">
          <h2 id="ai-intro-title">AI can be smart, but also…</h2>
        </div>
        <div class="ai-chat" aria-live="off">
          <header aria-label="Simulated chat window">
            <span class="dot" aria-hidden="true"></span>
            <span class="sr-only">Simulated chat window</span>
          </header>
          <div class="messages" id="ai-intro-messages"></div>
        </div>
      </div>
      <div>
        <h1><span class="accent">Nick Young</span></h1>
        <p>I’m creating ideas to learn: where AI helps, where it fails, and how the useful parts can plug into current systems.</p>
      </div>
    </section>

    <section id="featured">
      <div class="section-head">
        <h2>Featured Project</h2>
      </div>
      <div id="featured-project" aria-live="polite" aria-busy="true"></div>
      <p id="featured-status" class="projects-status" role="status">Loading featured project…</p>
    </section>

    <section id="projects">
      <div class="section-head">
        <h2>Project Timeline</h2>
      </div>
      <div id="project-timeline" class="timeline" aria-live="polite" aria-busy="true"></div>
      <p id="projects-status" class="projects-status" role="status">Loading projects…</p>
    </section>

    <section id="contact">
      <div class="section-head">
        <h2>Contact</h2>
      </div>
      <div class="contact-card reveal">
        <p><a href="mailto:NickYoungCI@gmail.com">NickYoungCI@gmail.com</a></p>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <div class="footer-row">
        <p style="margin:0;">© 2025 Nick Young.</p>
        <a class="back-to-top" href="#intro" aria-label="Back to top">↑ Back to top</a>
      </div>
    </div>
  </footer>

  <script>
    const io = new IntersectionObserver((entries) => {
      for (const entry of entries) {
        if (entry.isIntersecting) entry.target.classList.add('show');
      }
    }, { threshold: 0.12 });

    function observeReveals(root = document) {
      if (root && root.classList && root.classList.contains('reveal')) {
        io.observe(root);
      }
      if (root && root.querySelectorAll) {
        root.querySelectorAll('.reveal').forEach((el) => io.observe(el));
      }
    }
    observeReveals();

    (() => {
      const messages = document.getElementById('ai-intro-messages');

      const title = document.getElementById('ai-intro-title');
      if (!messages || !title) return;

      const headingStates = {
        intro: 'AI can be smart, but also…',
        contrast: 'AI can be smart, but also…'
      };

      const SPEED_MULTIPLIER = 3;
      const scale = (value = 0) => Math.round(value * SPEED_MULTIPLIER);

      const conversation = [
        {
          role: 'you',
          text: "How many R's are there in strawberry?",
          delayBefore: 0,
          type: true,
          loadingIndicator: 'cursor',
          loadingDuration: 1200
        },
        {
          role: 'ai',
          text: 'Seven.',
          delayBefore: 500,
          loadingIndicator: 'dots',
          loadingDuration: 900
        }
      ];

      const cls = { you: 'msg you', ai: 'msg ai' };
      let timers = [];

      const createEl = (tag, className, text) => {
        const el = document.createElement(tag);
        if (className) el.className = className;
        if (text != null) el.textContent = text;
        return el;
      };

      const clearTimers = () => {
        timers.forEach((id) => window.clearTimeout(id));
        timers = [];
      };

      const queue = (fn, delay) => {
        const id = window.setTimeout(fn, delay);
        timers.push(id);
      };

      const typingIndicator = () => {
        const wrap = createEl('span', 'ai-typing');
        wrap.setAttribute('aria-hidden', 'true');
        wrap.appendChild(createEl('span', 'dot'));
        wrap.appendChild(createEl('span', 'dot'));
        wrap.appendChild(createEl('span', 'dot'));
        return wrap;
      };

      const cursorIndicator = () => {
        const cursor = createEl('span', 'typing-cursor');
        cursor.setAttribute('aria-hidden', 'true');
        return cursor;
      };

      const indicatorFactories = {
        dots: typingIndicator,
        cursor: cursorIndicator
      };

      const addMessage = (role, text, options = {}) => {
        const { typed = false, onTypedComplete } = options;
        const bubble = createEl('div', cls[role] || 'msg');
        if (typed) {
          const sr = createEl('span', 'sr-only', text);
          bubble.appendChild(sr);

          const visible = createEl('span');
          bubble.appendChild(visible);

          let i = 0;
          const step = () => {
            visible.textContent = text.slice(0, ++i);
            if (i < text.length) queue(step, scale(18));
            else if (typeof onTypedComplete === 'function') onTypedComplete();
          };
          step();
        } else {
          bubble.textContent = text;
          if (typeof onTypedComplete === 'function') onTypedComplete();
        }
        messages.appendChild(bubble);
        messages.scrollTop = messages.scrollHeight;
      };

      const createPlaceholder = (item) => {
        const factory = indicatorFactories[item.loadingIndicator];
        if (!factory) return null;
        const bubble = createEl('div', cls[item.role] || 'msg');
        const indicator = factory();
        if (indicator) bubble.appendChild(indicator);
        bubble.appendChild(createEl('span', 'sr-only', 'Loading…'));
        messages.appendChild(bubble);
        messages.scrollTop = messages.scrollHeight;
        return bubble;
      };

      const runConversation = (items, { onFinished } = {}) => {
        let elapsed = 0;

        items.forEach((item) => {
          const delay = scale(item.delayBefore || 0);
          const indicatorWait = item.loadingIndicator ? scale(item.loadingDuration ?? (item.type ? 1200 : 900)) : 0;
          const typedWait = item.type ? scale((item.text?.length || 0) * 18) : 0;

          elapsed += delay;

          queue(() => {
            const placeholder = createPlaceholder(item);
            const reveal = () => {
              if (placeholder) placeholder.remove();
              addMessage(item.role, item.text, { typed: Boolean(item.type), onTypedComplete: item.onTypedComplete });
            };

            if (indicatorWait) {
              queue(reveal, indicatorWait);
            } else {
              reveal();
            }
          }, elapsed);

          elapsed += indicatorWait + typedWait;
        });

        if (typeof onFinished === 'function') {
          queue(onFinished, elapsed + scale(1600));
        }
      };

      const start = () => {
        clearTimers();
        messages.innerHTML = '';
        title.textContent = headingStates.intro;

        runConversation(conversation);
      };

      start();
    })();

    const featuredContainer = document.getElementById('featured-project');
    const featuredStatus = document.getElementById('featured-status');
    const timelineContainer = document.getElementById('project-timeline');
    const projectsStatus = document.getElementById('projects-status');
    const projectsSection = document.getElementById('projects');

    let timelineEntries = [];
    let expandedTimelineEntry = null;
    let timelineInView = false;
    let timelineUpdateQueued = false;

    const setEntryExpanded = (entry, expanded) => {
      if (!entry) return;
      entry.classList.toggle('is-expanded', expanded);
      const small = entry.querySelector('[data-preview="small"]');
      const large = entry.querySelector('[data-preview="large"]');
      if (small) small.setAttribute('aria-hidden', expanded ? 'true' : 'false');
      if (large) large.setAttribute('aria-hidden', expanded ? 'false' : 'true');
    };

    const evaluateTimelineFocus = () => {
      if (!timelineEntries.length || !timelineInView) return;

      const viewportCenter = window.innerHeight / 2;
      let closest = null;
      let closestDistance = Number.POSITIVE_INFINITY;

      timelineEntries.forEach((entry) => {
        const rect = entry.getBoundingClientRect();
        if (rect.bottom <= 0 || rect.top >= window.innerHeight) return;
        const entryCenter = rect.top + rect.height / 2;
        const distance = Math.abs(entryCenter - viewportCenter);
        if (distance < closestDistance) {
          closestDistance = distance;
          closest = entry;
        }
      });

      if (!closest) closest = timelineEntries[0];
      if (closest && closest !== expandedTimelineEntry) {
        if (expandedTimelineEntry) setEntryExpanded(expandedTimelineEntry, false);
        setEntryExpanded(closest, true);
        expandedTimelineEntry = closest;
      }
    };

    const scheduleTimelineUpdate = () => {
      if (!timelineEntries.length || timelineUpdateQueued) return;
      timelineUpdateQueued = true;
      window.requestAnimationFrame(() => {
        timelineUpdateQueued = false;
        evaluateTimelineFocus();
      });
    };

    const handleTimelineScroll = () => {
      if (!timelineInView) return;
      scheduleTimelineUpdate();
    };

    if (projectsSection) {
      const sectionObserver = new IntersectionObserver((entries) => {
        timelineInView = entries.some((entry) => entry.isIntersecting);
        if (!timelineInView && expandedTimelineEntry) {
          setEntryExpanded(expandedTimelineEntry, false);
          expandedTimelineEntry = null;
        } else if (timelineInView) {
          scheduleTimelineUpdate();
        }
      }, { threshold: 0.35 });
      sectionObserver.observe(projectsSection);
    }

    if (timelineContainer) {
      window.addEventListener('scroll', handleTimelineScroll, { passive: true });
      window.addEventListener('resize', scheduleTimelineUpdate);
      timelineContainer.addEventListener('focusin', (event) => {
        const entry = event.target.closest('.timeline-entry');
        if (!entry) return;
        if (expandedTimelineEntry && expandedTimelineEntry !== entry) {
          setEntryExpanded(expandedTimelineEntry, false);
        }
        setEntryExpanded(entry, true);
        expandedTimelineEntry = entry;
      });
    }

    function formatProjectDate(value) {
      if (!value) return '';
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return '';
      return new Intl.DateTimeFormat('en', { month: 'short', year: 'numeric' }).format(date);
    }

    function createTagList(tags = []) {
      if (!tags.length) return '';
      return `<div class="tag-list">${tags.map((tag) => `<span class="tag">${tag}</span>`).join('')}</div>`;
    }

    function renderFeatured(project) {
      if (!featuredContainer) return;
      if (!project) {
        featuredContainer.innerHTML = '';
        if (featuredStatus) {
          featuredStatus.textContent = 'Featured project coming soon.';
          featuredStatus.hidden = false;
        }
        featuredContainer.setAttribute('aria-busy', 'false');
        return;
      }

      const card = document.createElement('a');
      card.className = 'featured-card reveal';
      card.href = project.url || '#';
      card.innerHTML = `
        <div class="featured-media">
          ${project.previewImage ? `<img src="${project.previewImage}" alt="${project.previewAlt || project.title}" loading="lazy">` : ''}
        </div>
        <div class="featured-body">
          <div class="featured-meta">${formatProjectDate(project.date) || 'Undated project'}</div>
          <h3>${project.title}</h3>
          <p>${project.summary || ''}</p>
          ${createTagList(project.tags)}
        </div>
      `;
      featuredContainer.innerHTML = '';
      featuredContainer.appendChild(card);
      featuredContainer.setAttribute('aria-busy', 'false');
      if (featuredStatus) featuredStatus.hidden = true;
      observeReveals(featuredContainer);
    }

    function createTimelineItem(project) {
      const article = document.createElement('article');
      article.className = 'timeline-entry reveal';
      const formattedDate = formatProjectDate(project.date) || 'Undated';
      const tagSummary = (project.tags && project.tags.length)
        ? project.tags.slice(0, 2).join(' · ')
        : 'Project highlight';
      article.innerHTML = `
        <div class="timeline-date-bucket">
          <div class="timeline-marker">
            <div class="timeline-date">${formattedDate}</div>
          </div>
        </div>
        <div class="timeline-window">
          <a class="timeline-card" href="${project.url || '#'}">
            <div class="timeline-preview timeline-preview-small" data-preview="small" aria-hidden="false">
              ${project.previewImage ? `<div class="timeline-preview-media"><img src="${project.previewImage}" alt="${project.previewAlt || project.title}" loading="lazy"></div>` : ''}
              <div class="timeline-preview-content">
                <h3>${project.title}</h3>
                <p>${project.summary || ''}</p>
              </div>
            </div>
            <div class="timeline-preview timeline-preview-large" data-preview="large" aria-hidden="true">
              ${project.previewImage ? `<div class="timeline-preview-media"><img src="${project.previewImage}" alt="${project.previewAlt || project.title}" loading="lazy"></div>` : ''}
              <div class="timeline-preview-content">
                <div class="timeline-preview-meta">
                  <span>${tagSummary}</span>
                  <span>${formattedDate}</span>
                </div>
                <h3>${project.title}</h3>
                <p>${project.summary || ''}</p>
                ${createTagList(project.tags)}
                <span class="timeline-cta">View project</span>
              </div>
            </div>
          </a>
        </div>
      `;
      return article;
    }

    async function loadProjects() {
      if (!timelineContainer) return;
      timelineContainer.setAttribute('aria-busy', 'true');
      if (projectsStatus) {
        projectsStatus.textContent = 'Loading projects…';
        projectsStatus.hidden = false;
      }
      if (featuredContainer) featuredContainer.setAttribute('aria-busy', 'true');
      if (featuredStatus) {
        featuredStatus.textContent = 'Loading featured project…';
        featuredStatus.hidden = false;
      }

      try {
        const res = await fetch('projects/projects.json', { cache: 'no-cache' });
        if (!res.ok) throw new Error('Request failed');
        const projects = await res.json();

        const featuredProject = projects.find((project) => project.featured);
        renderFeatured(featuredProject);

        const sortedProjects = [...projects].sort((a, b) => {
          const dateA = new Date(a.date || 0).getTime();
          const dateB = new Date(b.date || 0).getTime();
          return dateB - dateA;
        });

        timelineContainer.innerHTML = '';
        timelineEntries = [];
        sortedProjects.forEach((project) => {
          const item = createTimelineItem(project);
          timelineContainer.appendChild(item);
          observeReveals(item);
        });

        timelineEntries = Array.from(timelineContainer.querySelectorAll('.timeline-entry'));
        if (timelineEntries.length) {
          if (timelineInView) {
            scheduleTimelineUpdate();
          } else if (expandedTimelineEntry) {
            setEntryExpanded(expandedTimelineEntry, false);
            expandedTimelineEntry = null;
          }
        } else if (expandedTimelineEntry) {
          setEntryExpanded(expandedTimelineEntry, false);
          expandedTimelineEntry = null;
        }

        if (!sortedProjects.length) {
          if (projectsStatus) {
            projectsStatus.textContent = 'No projects to show yet. Check back soon.';
            projectsStatus.hidden = false;
          }
        } else if (projectsStatus) {
          projectsStatus.hidden = true;
        }
      } catch (err) {
        timelineContainer.innerHTML = '';
        timelineEntries = [];
        if (expandedTimelineEntry) {
          setEntryExpanded(expandedTimelineEntry, false);
          expandedTimelineEntry = null;
        }
        if (projectsStatus) {
          projectsStatus.textContent = 'Unable to load projects right now.';
          projectsStatus.hidden = false;
        }
        if (featuredStatus) {
          featuredStatus.textContent = 'Unable to load the featured project right now.';
          featuredStatus.hidden = false;
        }
      } finally {
        timelineContainer.setAttribute('aria-busy', 'false');
        if (featuredContainer) featuredContainer.setAttribute('aria-busy', 'false');
      }
    }

    loadProjects();
  </script>
</body>
</html>

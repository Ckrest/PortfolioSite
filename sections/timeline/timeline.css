/**
 * Timeline Section
 *
 * Timeline-specific styles that extend the base project-entry component.
 * Sets phase accent colors and provides layout for phase sections.
 *
 * Base entry styles are in: css/components/project-entry.css
 */

[data-section="timeline"] {

  /* ═══════════════════════════════════════════════════════════════
     TIMELINE CONFIGURATION
     Sets CSS custom properties that project-entry.css uses
     ═══════════════════════════════════════════════════════════════ */

  /* Override entry accent to use phase color */
  .project-entry {
    --entry-accent: var(--phase-accent, var(--color-accent));
  }

  /* ═══════════════════════════════════════════════════════════════
     TEMPORARILY HIDDEN - Connection rail/dots disabled for initial launch
     Code is preserved, just hidden via CSS
     ═══════════════════════════════════════════════════════════════ */

  .connection-controls {
    display: none !important;
  }

  /* ═══════════════════════════════════════════════════════════════
     TAG CONTROLS - Visibility toggle + filter cloud
     ═══════════════════════════════════════════════════════════════ */

  .tag-controls {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    margin-bottom: var(--entry-pad-lg);
    padding: var(--entry-pad-sm);
    background: var(--color-surface);
    border-radius: var(--radius-md);
  }

  /* Visibility toggle */
  .tag-visibility {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .tag-visibility__label {
    font-size: var(--entry-text-sm);
    color: var(--color-text-secondary);
    font-weight: 500;
  }

  .tag-visibility__buttons {
    display: flex;
    gap: var(--space-1);
  }

  .tag-visibility__btn {
    padding: var(--space-2) var(--space-3);
    background: transparent;
    border: 1px solid var(--color-border-subtle);
    border-radius: var(--radius-sm);
    font-size: var(--entry-text-sm);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .tag-visibility__btn:hover {
    background: var(--color-surface-soft);
    color: var(--color-text);
  }

  .tag-visibility__btn.is-active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  /* Tag cloud filter */
  .tag-cloud {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .tag-cloud__label {
    font-size: var(--entry-text-sm);
    color: var(--color-text-secondary);
    font-weight: 500;
  }

  .tag-cloud__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .tag-cloud__tag {
    padding: var(--space-2) var(--space-3);
    background: transparent;
    border: 1px solid var(--color-border-subtle);
    border-radius: var(--radius-full);
    font-size: var(--entry-text-sm);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .tag-cloud__tag:hover {
    background: var(--color-surface-soft);
    color: var(--color-text);
    border-color: var(--color-border);
  }

  .tag-cloud__tag.is-active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  /* ═══════════════════════════════════════════════════════════════
     FILTERED STATES - Hide non-matching entries
     ═══════════════════════════════════════════════════════════════ */

  .project-entry.is-filtered-out,
  .timeline-bundle.is-filtered-out {
    display: none;
  }

  /* Highlight matching tags on visible entries */
  .project-entry__tags .tag.tag--selected {
    background: var(--color-accent);
    color: white;
  }
}

/* =============================================================================
   TAGS HIDDEN STATE
   When .tags-hidden is on the section, hide cloud and all card tags
   ============================================================================= */

[data-section="timeline"].tags-hidden .tag-cloud,
[data-section="timeline"].tags-hidden .project-entry__tags {
  display: none;
}

[data-section="timeline"] {

  /* ═══════════════════════════════════════════════════════════════
     PHASE SECTIONS
     ═══════════════════════════════════════════════════════════════ */

  .timeline-phase {
    --phase-accent: var(--color-accent);
    margin-bottom: clamp(2rem, 5vw, 3rem);
  }

  .timeline-phase:last-child {
    margin-bottom: 0;
  }

  .timeline-phase-header {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: var(--space-2) var(--space-3);
    margin-bottom: var(--entry-pad-md);
  }

  .timeline-phase-title {
    font-size: clamp(1.25rem, 2.8vw, 1.4rem);  /* ~40% larger than base */
    font-weight: 600;
    color: var(--phase-accent);
    margin: 0;
  }

  .timeline-phase-dates {
    font-size: var(--entry-text-base);
    color: var(--color-text-secondary);
  }

  /* ═══════════════════════════════════════════════════════════════
     ENTRIES CONTAINER
     ═══════════════════════════════════════════════════════════════ */

  .timeline-entries {
    display: flex;
    flex-direction: column;
    gap: clamp(0.75rem, 1vw + 0.5rem, 1rem);
    /* Reserve space for connection rail on left (no transition to avoid measurement issues) */
    padding-left: var(--rail-space, 0);
  }

  /* When connections are active, add space for the rail */
  .timeline-entries.has-connections {
    --rail-space: 26px;
    --dot-x: 8px;  /* Dot center position from left edge of container */
  }

  /* ═══════════════════════════════════════════════════════════════
     BUNDLE - Collapsible group of small items
     ═══════════════════════════════════════════════════════════════ */

  .timeline-bundle {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    border-left: 3px solid var(--phase-accent);
    padding: var(--entry-pad-md);
  }

  .timeline-bundle .project-entry__date {
    font-size: var(--entry-text-xs);
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
    margin-bottom: var(--space-2);
  }

  .bundle-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: 0;
    background: none;
    border: none;
    color: var(--color-text);
    font: inherit;
    font-size: var(--entry-text-base);
    font-weight: 500;
    cursor: pointer;
    min-height: var(--entry-touch-min);
    transition: color var(--transition-fast);
  }

  .bundle-header:hover {
    color: var(--phase-accent);
  }

  .bundle-toggle {
    font-size: 10px;
    color: var(--color-text-secondary);
    transition: transform var(--transition-fast);
  }

  .timeline-bundle.is-expanded .bundle-toggle {
    transform: rotate(90deg);
  }

  /* Icon row preview */
  .bundle-icons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-top: var(--space-2);
  }

  .bundle-icon {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    background: var(--color-surface-soft);
    object-fit: contain;
    padding: 4px;
    transition: transform var(--transition-fast), opacity var(--transition-fast);
  }

  .bundle-icon:hover {
    transform: scale(1.1);
  }

  /* Hide icons when expanded (full entries shown instead) */
  .timeline-bundle.is-expanded .bundle-icons {
    display: none;
  }

  .bundle-expanded {
    display: none;
    margin-top: var(--entry-pad-md);
    padding-top: var(--entry-pad-sm);
    border-top: 1px solid var(--color-border-subtle);
  }

  .timeline-bundle.is-expanded .bundle-expanded {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  /* Entries inside bundle - simpler treatment */
  .bundle-expanded .project-entry {
    padding: var(--entry-pad-sm);
    background: var(--color-surface-soft);
    --entry-stripe-width: 2px;
  }

  .bundle-expanded .project-entry:hover {
    background: color-mix(in oklab, var(--color-surface-soft), var(--phase-accent) 5%);
  }

  /* ═══════════════════════════════════════════════════════════════
     REVEAL ANIMATION - Staggered for timeline
     ═══════════════════════════════════════════════════════════════ */

  .timeline-entries .reveal:nth-child(1) { transition-delay: 0s; }
  .timeline-entries .reveal:nth-child(2) { transition-delay: 0.05s; }
  .timeline-entries .reveal:nth-child(3) { transition-delay: 0.1s; }
  .timeline-entries .reveal:nth-child(4) { transition-delay: 0.15s; }
  .timeline-entries .reveal:nth-child(5) { transition-delay: 0.2s; }

  /* ═══════════════════════════════════════════════════════════════
     HIGHLIGHT ANIMATION - Deep link scroll target
     ═══════════════════════════════════════════════════════════════ */

  .project-entry.is-highlighted,
  .timeline-bundle.is-highlighted {
    animation: highlight-pulse 2s ease-out;
  }

  @keyframes highlight-pulse {
    0%, 100% { box-shadow: none; }
    20% { box-shadow: 0 0 0 4px var(--phase-accent, var(--color-accent)); }
  }

  /* ═══════════════════════════════════════════════════════════════
     CONNECTION CONTROLS - Mode selector
     ═══════════════════════════════════════════════════════════════ */

  .connection-controls {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-3);
    padding-top: var(--space-3);
    border-top: 1px solid var(--color-border-subtle);
  }

  .connection-mode {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .connection-mode__label {
    font-size: var(--entry-text-sm);
    color: var(--color-text-secondary);
    font-weight: 500;
  }

  .connection-mode__buttons {
    display: flex;
    gap: var(--space-1);
  }

  .connection-mode__btn {
    padding: var(--space-2) var(--space-3);
    background: transparent;
    border: 1px solid var(--color-border-subtle);
    border-radius: var(--radius-sm);
    font-size: var(--entry-text-sm);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .connection-mode__btn:hover {
    background: var(--color-surface-soft);
    color: var(--color-text);
  }

  .connection-mode__btn.is-active {
    background: var(--color-accent-2, var(--color-accent));
    border-color: var(--color-accent-2, var(--color-accent));
    color: white;
  }

  /* Group selector (shown when "By Group" mode is active) */
  .group-selector {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-left: var(--space-3);
    padding-left: var(--space-3);
    border-left: 1px solid var(--color-border-subtle);
  }

  .group-selector[hidden] {
    display: none;
  }

  .group-selector__btn {
    padding: var(--space-1) var(--space-2);
    background: transparent;
    border: 1px solid var(--color-border-subtle);
    border-radius: var(--radius-full);
    font-size: var(--entry-text-xs);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .group-selector__btn:hover {
    background: var(--color-surface-soft);
  }

  .group-selector__btn.is-active {
    background: var(--color-accent-2, var(--color-accent));
    border-color: var(--color-accent-2, var(--color-accent));
    color: white;
  }

  /* ═══════════════════════════════════════════════════════════════
     CONNECTION VISUALS - Dots and lines drawn by JS at container level

     Both dots and lines are created dynamically by drawConnectionLines()
     in timeline-items.js. This consolidates all connection drawing logic
     in one place, eliminating previous sync issues between CSS and JS.
     ═══════════════════════════════════════════════════════════════ */

  .connection-dot {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--color-accent-2, var(--color-accent));
    transform: translate(-50%, -50%);
    z-index: 2;
    pointer-events: none;
  }

  .connection-line {
    position: absolute;
    width: 2px;
    background: var(--color-accent-2, var(--color-accent));
    opacity: 0.6;
    transform: translateX(-50%);
    z-index: 1;
    pointer-events: none;
    border-radius: 1px;
  }

}

